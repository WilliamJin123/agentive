---
phase: 07-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - hfs/cli/main.py
  - hfs/tests/test_integration.py
autonomous: true

must_haves:
  truths:
    - "MockLLMClient class does not exist in the codebase"
    - "Unit tests in test_integration.py run without API keys"
    - "grep for 'class MockLLMClient' returns no results"
  artifacts:
    - path: "hfs/cli/main.py"
      provides: "CLI without MockLLMClient"
      contains: "cmd_run"
      not_contains: "class MockLLMClient"
    - path: "hfs/tests/test_integration.py"
      provides: "Integration tests with unittest.mock"
      contains: "from unittest.mock import"
      not_contains: "class MockLLMClient"
  key_links:
    - from: "hfs/tests/test_integration.py"
      to: "unittest.mock.Mock"
      via: "MockLLMClient replacement"
      pattern: "Mock\\(\\)|MagicMock\\(\\)|AsyncMock\\(\\)"
---

<objective>
Remove MockLLMClient class from the codebase

Purpose: Eliminate the mock LLM client fallback so HFS requires real API keys to run. MockLLMClient exists in two places and must be deleted from both. Tests that relied on MockLLMClient must be updated to use unittest.mock instead.

Output:
- hfs/cli/main.py without MockLLMClient class (lines 27-84 deleted)
- hfs/tests/test_integration.py without MockLLMClient class, using unittest.mock instead
</objective>

<execution_context>
@C:\Users\jinwi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jinwi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-cleanup/07-RESEARCH.md

# Source files to modify
@hfs/cli/main.py
@hfs/tests/test_integration.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete MockLLMClient from CLI</name>
  <files>hfs/cli/main.py</files>
  <action>
Delete the MockLLMClient class (lines 27-84) from hfs/cli/main.py.

Do NOT delete any other code - only the MockLLMClient class definition.

Also update cmd_run() to remove the line that creates MockLLMClient:
- Delete: `print("\nNote: Using mock LLM client. For production, configure actual API credentials.")`
- Delete: `llm_client = MockLLMClient()`
- Leave the orchestrator creation line, but it will now need to handle missing llm_client (handled in Plan 02)

After this change, cmd_run() should NOT create any llm_client. The Plan 02 will add the API key check and proper initialization.
  </action>
  <verify>
Run: `python -c "from hfs.cli.main import MockLLMClient" 2>&1`
Should fail with ImportError (class no longer exists)

Run: `grep -n "class MockLLMClient" hfs/cli/main.py`
Should return no results
  </verify>
  <done>MockLLMClient class removed from hfs/cli/main.py, llm_client instantiation removed from cmd_run()</done>
</task>

<task type="auto">
  <name>Task 2: Replace MockLLMClient in test_integration.py with unittest.mock</name>
  <files>hfs/tests/test_integration.py</files>
  <action>
Replace the MockLLMClient class (lines 28-108) with a simpler approach using unittest.mock.

1. Delete the entire MockLLMClient class definition (lines 28-108)

2. Add this replacement at the top of the file (after existing imports):
```python
from unittest.mock import Mock, AsyncMock
```

3. Replace the MockLLMClient usages in test fixtures with unittest.mock:

Create a new fixture function near the top of the test file:
```python
def create_mock_llm_client(response_mode: str = "default"):
    """Create a mock LLM client for testing.

    Args:
        response_mode: "default", "cooperative", "stubborn", or "error"
    """
    client = Mock()
    client.call_history = []
    client.response_count = 0

    async def mock_create_message(
        model="claude-sonnet-4-20250514",
        max_tokens=1000,
        messages=None,
        system=None,
        **kwargs
    ):
        client.call_history.append({
            "model": model,
            "max_tokens": max_tokens,
            "messages": messages or [],
            "system": system,
            "kwargs": kwargs,
        })
        client.response_count += 1

        if response_mode == "error":
            raise Exception("Mock API error")

        # Generate appropriate response based on context
        context = str(messages) + str(system) if messages or system else ""

        if "negotiate" in context.lower():
            text = {"cooperative": "concede", "stubborn": "hold"}.get(response_mode, "revise")
        elif "deliberate" in context.lower() or "proposal" in context.lower():
            text = "Mock proposal content for testing"
        elif "execute" in context.lower() or "generate" in context.lower():
            text = "// Mock generated code\nexport const Component = () => <div>Test</div>;"
        else:
            text = "Mock LLM response"

        return {
            "content": [{"text": text}],
            "model": model,
            "usage": {"input_tokens": 100, "output_tokens": 50},
        }

    client.create_message = AsyncMock(side_effect=mock_create_message)

    def reset():
        client.call_history = []
        client.response_count = 0
    client.reset = reset

    return client
```

4. Update all test classes to use create_mock_llm_client() instead of MockLLMClient():
- Replace `MockLLMClient()` with `create_mock_llm_client()`
- Replace `MockLLMClient(response_mode="...")` with `create_mock_llm_client(response_mode="...")`

5. Delete the TestMockLLMClient test class entirely - it tests the mock itself which is no longer needed.

IMPORTANT: Keep all other test classes (TestOrchestratorInitialization, TestOrchestratorComponents, TestHFSPipelinePhases, TestFullPipelineRun, TestPipelineErrorHandling, TestNegotiationPhase, TestIntegrationPhase, TestRunHFSConvenienceFunction, TestEndToEndScenarios). They are valuable unit tests.
  </action>
  <verify>
Run: `python -c "from hfs.tests.test_integration import MockLLMClient" 2>&1`
Should fail with ImportError (class no longer exists)

Run: `grep -n "class MockLLMClient" hfs/tests/test_integration.py`
Should return no results

Run: `pytest hfs/tests/test_integration.py -v --collect-only 2>&1 | head -30`
Should show test collection succeeds (tests are discoverable)
  </verify>
  <done>MockLLMClient class removed from test_integration.py, replaced with unittest.mock-based create_mock_llm_client() function, all tests updated to use new function</done>
</task>

</tasks>

<verification>
After both tasks complete:

1. MockLLMClient class exists nowhere in codebase:
   `grep -rn "class MockLLMClient" hfs/`
   Should return empty

2. No import errors when importing modified modules:
   `python -c "from hfs.cli import main; from hfs.tests import test_integration; print('OK')"`

3. Test collection works:
   `pytest hfs/tests/test_integration.py --collect-only`
</verification>

<success_criteria>
- [ ] MockLLMClient class deleted from hfs/cli/main.py
- [ ] MockLLMClient class deleted from hfs/tests/test_integration.py
- [ ] test_integration.py uses unittest.mock instead
- [ ] All test classes except TestMockLLMClient preserved
- [ ] grep for "class MockLLMClient" returns no results
- [ ] No import errors in modified files
</success_criteria>

<output>
After completion, create `.planning/phases/07-cleanup/07-01-SUMMARY.md`
</output>
