---
phase: 03-agno-teams
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - hfs/agno/teams/dialectic.py
  - hfs/presets/dialectic.py
  - hfs/agno/teams/__init__.py
  - hfs/tests/test_dialectic_agno_triad.py
autonomous: true

must_haves:
  truths:
    - "DialecticAgnoTriad creates Team with proposer + critic + synthesizer"
    - "Synthesizer produces phase transition summaries per CONTEXT.md"
    - "Fixed roles - proposer/critic/synthesizer don't rotate between rounds"
    - "Thesis-antithesis-synthesis flow via team.arun()"
    - "Session state stores synthesizer summaries for next phase"
  artifacts:
    - path: "hfs/agno/teams/dialectic.py"
      provides: "DialecticAgnoTriad implementation"
      exports: ["DialecticAgnoTriad"]
    - path: "hfs/tests/test_dialectic_agno_triad.py"
      provides: "Unit tests for dialectic triad"
      min_lines: 50
  key_links:
    - from: "hfs/agno/teams/dialectic.py"
      to: "hfs/agno/teams/base.py"
      via: "AgnoTriad inheritance"
      pattern: "class DialecticAgnoTriad\\(AgnoTriad\\)"
    - from: "hfs/agno/teams/dialectic.py"
      to: "agno.team.Team"
      via: "Team creation"
      pattern: "Team\\("
    - from: "hfs/agno/teams/dialectic.py"
      to: "hfs/agno/teams/schemas.py"
      via: "PhaseSummary for synthesizer"
      pattern: "PhaseSummary"
---

<objective>
Implement DialecticAgnoTriad - the thesis-antithesis-synthesis pattern as an Agno Team.

Purpose: Replace stub implementations with real Agno Team coordination where proposer generates (thesis), critic challenges (antithesis), and synthesizer resolves (synthesis) - with synthesizer producing phase transition summaries per CONTEXT.md.

Output: Working DialecticAgnoTriad with synthesizer-driven summaries and fixed role assignments.
</objective>

<execution_context>
@C:\Users\jinwi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jinwi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-agno-teams/03-CONTEXT.md
@.planning/phases/03-agno-teams/03-RESEARCH.md
@.planning/phases/03-agno-teams/03-01-SUMMARY.md
@hfs/agno/teams/base.py
@hfs/agno/teams/schemas.py
@hfs/presets/dialectic.py
@hfs/agno/tools/toolkit.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement DialecticAgnoTriad class</name>
  <files>hfs/agno/teams/dialectic.py</files>
  <action>
Create DialecticAgnoTriad extending AgnoTriad base class:

**Imports:**
```python
from agno.team import Team
from agno.agent import Agent
from typing import Dict, Any
from hfs.core.triad import TriadConfig, TriadOutput, NegotiationResponse
from hfs.agno.tools import HFSToolkit
from .base import AgnoTriad
from .schemas import PhaseSummary
```

**Class structure:**
1. `_create_agents(self) -> Dict[str, Agent]`:
   Create three agents with role-appropriate tools per CONTEXT.md:

   - **proposer**: Can register claims
     - Role: "Creative proposal generator (thesis)"
     - Instructions: Generate possibilities, explore design space, propose bold solutions
     - Tools: `self.toolkit.register_claim`, `self.toolkit.get_current_claims`

   - **critic**: Read-only state access
     - Role: "Proposal challenger (antithesis)"
     - Instructions: Find flaws, ask hard questions, challenge assumptions
     - Tools: `self.toolkit.get_negotiation_state`, `self.toolkit.get_current_claims`

   - **synthesizer**: Full toolkit for final decisions
     - Role: "Tension resolver (synthesis)"
     - Instructions: Resolve tensions, integrate best elements, produce coherent output
     - Tools: Full HFSToolkit
     - **Critical**: Synthesizer produces phase summaries (per CONTEXT.md)

2. `_create_team(self) -> Team`:
   Per CONTEXT.md fixed roles (no rotation):
   ```python
   return Team(
       name=f"triad_{self.config.id}",
       model=self.model,
       members=list(self.agents.values()),
       delegate_to_all_members=False,  # Explicit thesis->antithesis->synthesis flow
       share_member_interactions=True,  # All see prior contributions
       add_session_state_to_context=True,
       session_state=self._session_state.model_dump(),
   )
   ```

3. `_get_phase_summary_prompt(self, phase: str) -> str`:
   Return structured summary prompt for synthesizer:
   ```
   After completing the {phase} phase, produce a structured summary:

   ## Summary Template
   - **Decisions Made:** [List key decisions from this phase]
   - **Open Questions:** [List unresolved questions for next phase]
   - **Artifacts:** [List any outputs/proposals created]

   This summary will be passed to the next phase. Be concise but complete.
   ```

4. Prompt builders for dialectic flow:
   - `_build_deliberation_prompt(user_request, spec_state)`:
     Thesis-antithesis-synthesis for deliberation
   - `_build_negotiation_prompt(section, other_proposals)`:
     Dialectic evaluation of competing proposals
   - `_build_execution_prompt(frozen_spec)`:
     Dialectic code generation (propose -> critique -> finalize)

5. **Extract synthesizer summary** after team run:
   Helper method to parse PhaseSummary from synthesizer's output
   and store in session_state.

**Key patterns from CONTEXT.md:**
- Synthesizer produces phase transition summary (not orchestrator, not system)
- Fixed roles - proposer/critic/synthesizer don't rotate
- Structured template for summaries
  </action>
  <verify>
```bash
cd C:\Users\jinwi\programming_files_NEW\agentive
python -c "
from hfs.agno.teams.dialectic import DialecticAgnoTriad
print('DialecticAgnoTriad imported')
print('Has _create_agents:', hasattr(DialecticAgnoTriad, '_create_agents'))
print('Has _get_phase_summary_prompt:', hasattr(DialecticAgnoTriad, '_get_phase_summary_prompt'))
"
```
  </verify>
  <done>
DialecticAgnoTriad class exists with proposer/critic/synthesizer agents, synthesizer produces phase summaries.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update exports and existing preset</name>
  <files>hfs/agno/teams/__init__.py, hfs/presets/dialectic.py</files>
  <action>
1. **Update hfs/agno/teams/__init__.py:**
   Add DialecticAgnoTriad to exports:
   ```python
   from .dialectic import DialecticAgnoTriad
   ```

2. **Update hfs/presets/dialectic.py:**
   Add deprecation notice at the top:
   ```python
   """Dialectic Triad preset - thesis-antithesis-synthesis pattern.

   NOTE: For Agno-backed implementation with real LLM calls, use:
   from hfs.agno.teams import DialecticAgnoTriad

   This module provides the original stub implementation for reference
   and backwards compatibility during migration.
   """
   ```

   Keep existing implementation for Phase 7 cleanup.
  </action>
  <verify>
```bash
cd C:\Users\jinwi\programming_files_NEW\agentive
python -c "
from hfs.agno.teams import DialecticAgnoTriad
from hfs.presets.dialectic import DialecticTriad
print('Both implementations importable')
"
```
  </verify>
  <done>
DialecticAgnoTriad exported from hfs.agno.teams, existing preset has deprecation notice.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add unit tests for DialecticAgnoTriad</name>
  <files>hfs/tests/test_dialectic_agno_triad.py</files>
  <action>
Create comprehensive unit tests (no API calls - mock the model):

**Test fixtures:**
- Mock Model that returns canned responses
- Mock Spec with sections for testing
- TriadConfig with dialectic preset

**Tests:**
1. `test_dialectic_creates_three_agents`:
   Verify _create_agents returns proposer, critic, synthesizer

2. `test_proposer_can_register_claims`:
   Verify proposer has register_claim tool

3. `test_critic_has_readonly_tools`:
   Verify critic only has get_negotiation_state, get_current_claims

4. `test_synthesizer_has_full_toolkit`:
   Verify synthesizer has full HFSToolkit access

5. `test_team_not_broadcast`:
   Verify delegate_to_all_members=False for explicit flow

6. `test_phase_summary_prompt_structure`:
   Verify _get_phase_summary_prompt includes required sections

7. `test_session_state_stores_summaries`:
   Verify session state has fields for each phase's summary

8. `test_deliberation_prompt_dialectic_flow`:
   Verify prompt mentions thesis->antithesis->synthesis

9. `test_fixed_roles_not_rotating`:
   Verify agent roles don't change between phases

Use pytest, unittest.mock for Model mocking. No actual API calls.
  </action>
  <verify>
```bash
cd C:\Users\jinwi\programming_files_NEW\agentive
python -m pytest hfs/tests/test_dialectic_agno_triad.py -v
```
  </verify>
  <done>
All unit tests pass, verifying dialectic structure, synthesizer summaries, and fixed roles.
  </done>
</task>

</tasks>

<verification>
```bash
cd C:\Users\jinwi\programming_files_NEW\agentive

# 1. Import from package
python -c "
from hfs.agno.teams import DialecticAgnoTriad, AgnoTriad
print('DialecticAgnoTriad extends AgnoTriad:', issubclass(DialecticAgnoTriad, AgnoTriad))
"

# 2. Run unit tests
python -m pytest hfs/tests/test_dialectic_agno_triad.py -v

# 3. Verify agent structure
python -c "
from unittest.mock import Mock
from hfs.agno.teams import DialecticAgnoTriad
from hfs.core.triad import TriadConfig, TriadPreset

config = TriadConfig(
    id='test',
    preset=TriadPreset.DIALECTIC,
    scope_primary=['visual_design'],
    scope_reach=['motion_design'],
    budget_tokens=1000,
    budget_tool_calls=10,
    budget_time_ms=30000,
    objectives=['aesthetic_quality']
)
mock_model = Mock()
mock_spec = Mock()
mock_spec.sections = {}

try:
    triad = DialecticAgnoTriad(config, mock_model, mock_spec)
    print('Agents:', list(triad.agents.keys()))
except Exception as e:
    print('Expected with mock:', type(e).__name__)
"
```
</verification>

<success_criteria>
- DialecticAgnoTriad extends AgnoTriad base class
- Creates proposer, critic, synthesizer with appropriate tools
- Synthesizer has full toolkit and produces phase summaries
- Fixed roles (no rotation per CONTEXT.md)
- All unit tests pass
- Exportable from hfs.agno.teams
</success_criteria>

<output>
After completion, create `.planning/phases/03-agno-teams/03-03-SUMMARY.md`
</output>
